/*! simple-drawing-board / @version:1.1.0 @author:leader22 @license:MIT */ 
!function(t,i){"use strict";function e(t,i){this._ensureEl(t),this.ev=new e.util.Eve,this.el=t,this.ctx=t.getContext("2d"),this._elRect=t.getBoundingClientRect(),this._isDrawing=0,this._timer=null,this._coords={old:{x:0,y:0},oldMid:{x:0,y:0},current:{x:0,y:0}},this._settings={lineColor:null,lineSize:null,boardColor:null,historyDepth:null,isTransparent:null,isDrawMode:null},this._history={values:null,position:null},this._initHistory(),this._initBoard(i)}function s(t){return this.ctx.lineWidth=0|t||1,this}function o(t){return this.ctx.strokeStyle=t,this}function n(t){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this._saveHistory(),this}function r(){var t=this._settings;if(t.isTransparent){var i=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-out",this.fill(this._settings.boardColor),this.ctx.globalCompositeOperation=i}else this.fill(this._settings.boardColor);return this._saveHistory(),this}function a(){var t=this._settings;return t.isDrawMode?(this.setLineColor(t.boardColor),t.isTransparent&&(this.ctx.globalCompositeOperation="destination-out"),t.isDrawMode=0):(this.setLineColor(t.lineColor),t.isTransparent&&(this.ctx.globalCompositeOperation="source-over"),t.isDrawMode=1),this.ev.trigger("toggleMode",t.isDrawMode),this}function h(){return this.ctx.canvas.toDataURL("image/png")}function c(t){this.ctx;return"string"==typeof t?this._setImgByImgSrc(t):this._setImgByDrawableEl(t),this._saveHistory(),this}function l(){this._goThroughHistory(!1)}function u(){this._goThroughHistory(!0)}function d(){this._unbindEvents(),e.util.cAF(this._timer),this._timer=null,this._initHistory(),this.ev.trigger("dispose")}function v(t){if(!t||"object"!=typeof t||"canvas"!==t.tagName.toLowerCase())throw new Error("Pass canvas element as first argument.")}function g(t){var i=this._settings=e.util.Const.settings;if(t)for(var s in t)i[s]=t[s];e.util.isTransparent(i.boardColor)&&(i.boardColor="rgba(0,0,0,1)",i.isTransparent=1),i.isDrawMode=1,this.ctx.lineCap=this.ctx.lineJoin="round",this.setLineSize(i.lineSize),this.setLineColor(i.lineColor),this.clear(),this._bindEvents(),this._draw()}function p(){e.util.isTouch?(this.el.addEventListener("touchstart",this,!1),this.el.addEventListener("touchmove",this,!1),this.el.addEventListener("touchend",this,!1),this.el.addEventListener("touchcancel",this,!1),this.el.addEventListener("gesturestart",this,!1)):(this.el.addEventListener("mousedown",this,!1),this.el.addEventListener("mousemove",this,!1),this.el.addEventListener("mouseup",this,!1),this.el.addEventListener("mouseout",this,!1))}function m(){e.util.isTouch?(this.el.removeEventListener("touchstart",this,!1),this.el.removeEventListener("touchmove",this,!1),this.el.removeEventListener("touchend",this,!1),this.el.removeEventListener("touchcancel",this,!1),this.el.removeEventListener("gesturestart",this,!1)):(this.el.removeEventListener("mousedown",this,!1),this.el.removeEventListener("mousemove",this,!1),this.el.removeEventListener("mouseup",this,!1),this.el.removeEventListener("mouseout",this,!1))}function _(){var t=this._coords.old.x===this._coords.current.x&&this._coords.old.y===this._coords.current.y;if(this._isDrawing&&!t){var i=this._getMidInputCoords(this._coords.current);this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.quadraticCurveTo(this._coords.old.x,this._coords.old.y,this._coords.oldMid.x,this._coords.oldMid.y),this.ctx.stroke(),this._coords.old=this._coords.current,this._coords.oldMid=i,this.ev.trigger("draw",this._coords.current)}this._timer=e.util.rAF(this._draw.bind(this))}function f(t){this._isDrawing=1;var i=this._getInputCoords(t);this._coords.current=this._coords.old=i,this._coords.oldMid=this._getMidInputCoords(i)}function x(t){this._coords.current=this._getInputCoords(t)}function w(){this._isDrawing=0,this._saveHistory()}function y(t){switch(t.preventDefault(),t.stopPropagation(),t.type){case"mousedown":case"touchstart":this._onInputDown(t);break;case"mousemove":case"touchmove":this._onInputMove(t);break;case"mouseup":case"mouseout":case"touchend":case"touchcancel":case"gesturestart":this._onInputUp()}}function C(t){var i,e;return t.touches&&1===t.touches.length?(i=t.touches[0].pageX,e=t.touches[0].pageY):(i=t.pageX,e=t.pageY),{x:i-this._elRect.left,y:e-this._elRect.top}}function b(t){return{x:this._coords.old.x+t.x>>1,y:this._coords.old.y+t.y>>1}}function E(t){var i=new Image;i.onload=function(){var t=ctx.globalCompositeOperation;ctx.globalCompositeOperation="source-over",ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.drawImage(i,0,0,ctx.canvas.width,ctx.canvas.height),ctx.globalCompositeOperation=t},i.src=t}function L(t){if(e.util.isDrawableEl(src)){var i=ctx.globalCompositeOperation;ctx.globalCompositeOperation="source-over",ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.drawImage(t,0,0,ctx.canvas.width,ctx.canvas.height),ctx.globalCompositeOperation=i}}function D(){this._history={values:[],position:0}}function I(){var t=this._history,i=this.getImg(),e=t.values[t.values.length-1];if(!e||i!==e){for(;t.values.length>=this._settings.historyDepth;)t.values.shift(),t.position--;0!==t.position&&t.position<t.values.length?(t.values=t.values.slice(0,t.position),t.position++):t.position=t.values.length+1,t.values.push(i),this.ev.trigger("save",i)}}function M(t){var e=this._history;if(!(t&&e.position===e.values.length||!t&&1===e.position)){var s=t?e.position+1:e.position-1;e.values.length&&e.values[s-1]!==i&&(e.position=s,this.setImg(e.values[s-1]))}}e.prototype={constructor:e,setLineSize:s,setLineColor:o,fill:n,clear:r,toggleMode:a,getImg:h,setImg:c,undo:l,redo:u,dispose:d,handleEvent:y,_ensureEl:v,_initBoard:g,_bindEvents:p,_unbindEvents:m,_onInputDown:f,_onInputMove:x,_onInputUp:w,_draw:_,_getInputCoords:C,_getMidInputCoords:b,_setImgByImgSrc:E,_setImgByDrawableEl:L,_initHistory:D,_saveHistory:I,_goThroughHistory:M},t.SimpleDrawingBoard=e,"process"in t||"function"!=typeof define||!define.amd||define([],function(){return e})}(window),function(t,i){"use strict";function e(){return"ontouchstart"in t.document}function s(t){return t=t.replace(/\s/g,""),"transparent"===t?!0:"rgba(0,0,0,0)"===t?!0:!1}function o(t){var i=-1!==["img","canvas","video"].indexOf(t.tagName.toLowerCase());return i}function n(){return(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(i){t.setTimeout(i,1e3/60)}).bind(t)}function r(){return(t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||function(i){t.clearTimeout(i)}).bind(t)}function a(){this._events={}}if(!t.SimpleDrawingBoard)throw new Error("SimpleDrawingBoard is not defined in window.");t.SimpleDrawingBoard.util={isTouch:e(),isTransparent:s,isDrawableEl:o,rAF:n(),cAF:r(),Eve:a,Const:{settings:{lineColor:"#aaa",lineSize:5,boardColor:"transparent",historyDepth:10}}},a.prototype={constructor:a,on:function(t,i){var e=this._events;t in e||(e[t]=[]),e[t].push(i)},off:function(t,i){var e=this._events;if(t in e){i||(e[t]=[]);var s=e[t].indexOf(i);s>=0&&e[t].splice(s,1)}},trigger:function(t,i){var e,s=this._events;if(t in s)for(var o=0,n=s[t].length;n>o;o++)e=s[t][o],e.handleEvent?e.handleEvent.call(this,i):e.call(this,i)}}}(window);