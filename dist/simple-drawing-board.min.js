/*! simple-drawing-board / @version:1.0.0 @author:leader22 @license:MIT */ 
!function(t,i){"use strict";function e(t,i){this._ensureEl(t),this.ev=new e.util.Eve,this.el=t,this.ctx=t.getContext("2d"),this._elRect=t.getBoundingClientRect(),this._isDrawing=0,this._timer=null,this._coords={old:{x:0,y:0},oldMid:{x:0,y:0},current:{x:0,y:0}},this._settings={lineColor:null,lineSize:null,boardColor:null,historyDepth:null,isTransparent:null,isDrawMode:null},this._history={values:null,position:null},this._initHistory(),this._initBoard(i)}function s(t){return this.ctx.lineWidth=0|t||1,this}function o(t){return this.ctx.strokeStyle=t,this}function n(t){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this._saveHistory(),this}function r(){var t=this._settings;if(t.isTransparent){var i=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-out",this.fill(this._settings.boardColor),this.ctx.globalCompositeOperation=i}else this.fill(this._settings.boardColor);return this._saveHistory(),this}function a(){var t=this._settings;return t.isDrawMode?(this.setLineColor(t.boardColor),t.isTransparent&&(this.ctx.globalCompositeOperation="destination-out"),t.isDrawMode=0):(this.setLineColor(t.lineColor),t.isTransparent&&(this.ctx.globalCompositeOperation="source-over"),t.isDrawMode=1),this}function h(){return this.ctx.canvas.toDataURL("image/png")}function u(t){var i=this.ctx,e=new Image;e.onload=function(){var t=i.globalCompositeOperation;i.globalCompositeOperation="source-over",i.clearRect(0,0,i.canvas.width,i.canvas.height),i.drawImage(e,0,0),i.globalCompositeOperation=t},e.src=t}function l(){this._goThroughHistory(!1)}function c(){this._goThroughHistory(!0)}function d(){this._unbindEvents(),e.util.cAF(this._timer),this._timer=null,this._initHistory()}function v(t){if(!t||"object"!=typeof t||"canvas"!==t.tagName.toLowerCase())throw new Error("Pass canvas element as first argument.")}function p(t){var i=this._settings=e.util.Const.settings;if(t)for(var s in t)i[s]=t[s];e.util.isTransparent(i.boardColor)&&(i.boardColor="rgba(0,0,0,1)",i.isTransparent=1),i.isDrawMode=1,this.ctx.lineCap=this.ctx.lineJoin="round",this.setLineSize(i.lineSize),this.setLineColor(i.lineColor),this.clear(),this._bindEvents(),this._draw()}function g(){e.util.isTouch?(this.el.addEventListener("touchstart",this,!1),this.el.addEventListener("touchmove",this,!1),this.el.addEventListener("touchend",this,!1),this.el.addEventListener("touchcancel",this,!1),this.el.addEventListener("gesturestart",this,!1)):(this.el.addEventListener("mousedown",this,!1),this.el.addEventListener("mousemove",this,!1),this.el.addEventListener("mouseup",this,!1),this.el.addEventListener("mouseout",this,!1))}function _(){e.util.isTouch?(this.el.removeEventListener("touchstart",this,!1),this.el.removeEventListener("touchmove",this,!1),this.el.removeEventListener("touchend",this,!1),this.el.removeEventListener("touchcancel",this,!1),this.el.removeEventListener("gesturestart",this,!1)):(this.el.removeEventListener("mousedown",this,!1),this.el.removeEventListener("mousemove",this,!1),this.el.removeEventListener("mouseup",this,!1),this.el.removeEventListener("mouseout",this,!1))}function m(){if(this._isDrawing){var t=this._getMidInputCoords(this._coords.current);this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.quadraticCurveTo(this._coords.old.x,this._coords.old.y,this._coords.oldMid.x,this._coords.oldMid.y),this.ctx.stroke(),this._coords.old=this._coords.current,this._coords.oldMid=t}this._timer=e.util.rAF(this._draw.bind(this))}function f(t){this._isDrawing=1;var i=this._getInputCoords(t);this._coords.current=this._coords.old=i,this._coords.oldMid=this._getMidInputCoords(i)}function w(t){this._coords.current=this._getInputCoords(t)}function C(){this._isDrawing=0,this._saveHistory()}function x(t){switch(t.preventDefault(),t.stopPropagation(),t.type){case"mousedown":case"touchstart":this._onInputDown(t);break;case"mousemove":case"touchmove":this._onInputMove(t);break;case"mouseup":case"mouseout":case"touchend":case"touchcancel":case"gesturestart":this._onInputUp()}}function y(t){var i,e;return t.touches&&1===t.touches.length?(i=t.touches[0].pageX,e=t.touches[0].pageY):(i=t.pageX,e=t.pageY),{x:i-this._elRect.left,y:e-this._elRect.top}}function E(t){return{x:this._coords.old.x+t.x>>1,y:this._coords.old.y+t.y>>1}}function b(){this._history={values:[],position:0}}function L(){var t=this._history,i=this.getImg(),e=t.values[t.values.length-1];if(!e||i!==e){for(;t.values.length>=this._settings.historyDepth;)t.values.shift(),t.position--;0!==t.position&&t.position<t.values.length?(t.values=t.values.slice(0,t.position),t.position++):t.position=t.values.length+1,t.values.push(i)}}function D(t){var e=this._history;if(!(t&&e.position===e.values.length||!t&&1===e.position)){var s=t?e.position+1:e.position-1;e.values.length&&e.values[s-1]!==i&&(e.position=s,this.setImg(e.values[s-1]))}}e.prototype={constructor:e,setLineSize:s,setLineColor:o,fill:n,clear:r,toggleMode:a,getImg:h,setImg:u,undo:l,redo:c,dispose:d,handleEvent:x,_ensureEl:v,_initBoard:p,_bindEvents:g,_unbindEvents:_,_onInputDown:f,_onInputMove:w,_onInputUp:C,_draw:m,_getInputCoords:y,_getMidInputCoords:E,_initHistory:b,_saveHistory:L,_goThroughHistory:D},t.SimpleDrawingBoard=e,"process"in t||"function"!=typeof define||!define.amd||define([],function(){return e})}(window),function(t,i){"use strict";function e(){return"ontouchstart"in t.document}function s(t){return t=t.replace(/\s/g,""),"transparent"===t?!0:"rgba(0,0,0,0)"===t?!0:!1}function o(){return(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(i){t.setTimeout(i,1e3/60)}).bind(t)}function n(){return(t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||function(i){t.clearTimeout(i)}).bind(t)}function r(){this._events={}}if(!t.SimpleDrawingBoard)throw new Error("SimpleDrawingBoard is not defined in window.");t.SimpleDrawingBoard.util={isTouch:e(),isTransparent:s,rAF:o(),cAF:n(),Eve:r,Const:{settings:{lineColor:"#aaa",lineSize:5,boardColor:"transparent",historyDepth:10}}},r.prototype={constructor:r,on:function(t,i){var e=this._events;t in e||(e[t]=[]),e[t].push(i)},off:function(t,i){var e=this._events;if(t in e){i||(e[t]=[]);var s=e[t].indexOf(i);s>=0&&e[t].splice(s,1)}},trigger:function(t,i){var e,s=this._events;if(t in s)for(var o=0,n=s[t].length;n>o;o++)e=s[t][o],e.handleEvent?e.handleEvent.call(this,i):e.call(this,i)}}}(window);